{% extends "gallery/base_tag_photo.html" %}

{% block extra_head %}
<script src="/gallery/static/navigation.js" type="text/javascript"></script>
{% endblock %}


{% block title %}Photo {{ photo.id }}{% endblock %}

{% block in_body %}
    <div>
       <div id="image" style="height:{{ photo.height }}px;">
	 <img border=0 id="preview" src="{{ exported.normal_url }}" 
	      height="{{ photo.height }}px;" width="{{ photo.width }}"/>
      
	 {% if previous %}
         <div class="prevthumb">
	   <a id="previousphoto" href="{{ previous.url }}">
	     <img alt="Previous" src="{{ previous.get_exported.thumb_url }}"/>
	     <br/>
	     Previous
	   </a>
	 </div>
	 {% endif %}


	 {% if next %}
	 <div class="nextthumb">
	   <a id="nextphoto" href="{{ next.url }}">
	     <img alt="Next" src="{{ next.get_exported.thumb_url }}"/>
	     <br/>
	     Next
	   </a>
	 </div>
	 {% endif %}
       </div>

	 <h2>{{ photo.description }}</h2>

	 <div id="tagsforphoto" style="text-align: center; margin-top:24px;">
	 <a href="{{ photo.url }}">Permanent link</a>
	   {% ifnotequal photo.get_hits 1 %}
	   {{photo.get_hits}} hits.
	   {% endifnotequal %}
	   Taken on <a href="{{photo.same_day_url}}">{{photo.get_date}}</a><br/>
	   {% if roll %}
	   <a href="{{ roll.url }}">Roll {{ roll.id }}</a><br/>
	     {% endif %}
	   Tags:
	   {% for tag in photo.get_tags %}
	   <a href="{{tag.url}}">{{tag.name}}</a>
	   {% endfor %}
	 </div>

	 <div id="exif_table" style="display: none;">
	   <table class="exif" border="0">
	   {% for info in photo.get_exif_infos %}
	     <tr><td align="right">{{ info.title }}: </td>
	         <td><b>{{ info.value }}</b></td></tr>
	   {% endfor %}
	   <tr>
	     <td></td><td><a href="javascript:toggle_div('exif_table');toggle_div('exif_line');">Less info</a></td></tr>

	   </table>
	 </div>

	 <div class="exif">
	   {% for info in photo.get_exif_infos %}
	     {% if forloop.counter0|divisibleby:"2" %}
	       |
	     {% endif %}
	     <span title="{{ info.title }}">{{ info.value }}</span>
	   {% endfor %}
           | <a href="javascript:toggle_div('exif_table');toggle_div('exif_line');">More info</a>
	 </div>

	 <div id="mqhq">
	   {% if exported.mq_url %}
  	   <a href="{{ exported.mq_url }}">MQ</a>
	   {% endif %}
	   {% if exported.hq_url %}
	   <a href="{{ exported.hq_url }}">HQ</a>
	   {% endif %}
	 </div>

	 {% for comment in photo.get_comments %}
	   {% ifequal forloop.counter0 0 %}
	     <div class="user_comment">
	   {% endifequal %}
	   {% if comment.public %}
	   <div class="commententry" id="c{{ comment.id }}">
	     <div class="name">
	      <a href="{{comment.url}}">#</a>
	       Comment from 
	       {% if comment.is_openid %}
	        <img src="/gallery/static/openid-14x14.png"/>
	       {% endif %}
	       <em>
		{% if comment.website %}
		  <a href="{{comment.website}}">{{comment.author}}</a>
		{% else %}
		  {{comment.author}}
		{% endif %}
	       </em>
	      {{comment.submit_date|timesince}} ago
	     </div>
	     
	     <div class="commentdata">
	       {{ comment.comment }}
	     </div>
	   </div>
           {% endif %}
	   {% if forloop.last %}
	     </div>
	   {% endif %}

	 {% endfor %}

	 <div id="comment_form" class="form">
	 <form method="post" action=".">
	   {% if request.openid %}
	   Posting using your OpenID identity
	   {% else %}
	   <p><a href="/gallery/openid/?next={{ photo.url }}">
	       Sign in with OpenID (optional)</a></p>
	   <div class="row">
	     <label class="label" for="id_author">Name:</label>
	     <div class="control">
	     {{ form.author }}
	     </div>
	     {% if form.author.errors %}*** {{ form.author.errors|join:", " }}{% endif %}
	   </div>

	   <div class="row">
	     <label class="label" for="id_website">Website:</label> 
	     <div class="control">
	     {{ form.website }}
	     </div>
	     {% if form.website.errors %}*** {{ form.website.errors|join:", " }}{% endif %}
	   </div>
	   
	   {% endif %}
	   <div class="row">
	     <label class="label" for="id_comment">Comment:</label> 
	     <div class="control">
	     {{ form.comment }}
	     </div>
	     {% if form.comment.errors %}*** {{ form.comment.errors|join:", " }}{% endif %}
	   </div>
	   <div class="row">
	     <label class="label"/>
	     <div class="control">
	       <input type="submit" />
	     </div>
	   </div>
	 </form>
	 </div>

    </div>
{% endblock %}
